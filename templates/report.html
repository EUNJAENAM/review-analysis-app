<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        /* 기본 스타일 */
        body {
            font-family: 'NanumBarunGothic', 'Malgun Gothic', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* PDF 전용 스타일 */
        @media print {
            body {
                background-color: white !important;
                color: black !important;
                font-size: 12px !important;
                line-height: 1.4 !important;
            }
            .container {
                background-color: white !important;
                box-shadow: none !important;
                padding: 15px !important;
                max-width: none !important;
            }
            .header h1 {
                font-size: 1.8em !important;
                margin-bottom: 10px !important;
            }
            .header p {
                font-size: 0.9em !important;
                margin: 5px 0 !important;
            }
            .section {
                background-color: white !important;
                border: 1px solid #000 !important;
                margin-bottom: 20px !important;
                padding: 15px !important;
                page-break-inside: avoid !important;
            }
            .section h2 {
                font-size: 1.3em !important;
                margin-bottom: 10px !important;
                padding-bottom: 5px !important;
            }
            .kpi-card {
                background: #4682B4 !important;
                color: white !important;
                border: 1px solid #000 !important;
                padding: 15px !important;
                margin-bottom: 10px !important;
            }
            .kpi-card h3 {
                font-size: 1em !important;
                margin-bottom: 8px !important;
            }
            .kpi-card .value {
                font-size: 1.5em !important;
                margin: 8px 0 !important;
            }
            .kpi-card .unit {
                font-size: 0.8em !important;
            }
            .chart-container {
                margin: 15px 0 !important;
                page-break-inside: avoid !important;
            }
            .chart-container img {
                max-width: 90% !important;
                height: auto !important;
                max-height: 400px !important;
            }
            table {
                font-size: 11px !important;
                margin: 10px 0 !important;
            }
            th, td {
                padding: 8px !important;
            }
            th {
                background-color: #4682B4 !important;
                color: white !important;
                border: 1px solid #4682B4 !important;
                font-size: 11px !important;
            }
            .priority-high {
                color: #DC143C !important;
                font-weight: bold !important;
            }
            .priority-medium {
                color: #FF8C00 !important;
                font-weight: bold !important;
            }
            .priority-low {
                color: #32CD32 !important;
                font-weight: bold !important;
            }
            .insights {
                padding: 15px !important;
                margin: 10px 0 !important;
            }
            .insights ul {
                padding-left: 15px !important;
            }
            .insights li {
                margin-bottom: 5px !important;
                font-size: 11px !important;
            }
            .strategy-grid {
                gap: 15px !important;
                margin: 15px 0 !important;
            }
            .strategy-card {
                padding: 15px !important;
            }
            .strategy-card h4 {
                font-size: 1.1em !important;
                margin-bottom: 8px !important;
            }
            .strategy-card ul {
                padding-left: 15px !important;
            }
            .strategy-card li {
                margin-bottom: 5px !important;
                font-size: 11px !important;
            }
            .highlight {
                padding: 12px !important;
                margin: 10px 0 !important;
            }
            .highlight ul, .highlight ol {
                padding-left: 15px !important;
            }
            .highlight li {
                margin-bottom: 5px !important;
                font-size: 11px !important;
            }
            .footer {
                margin-top: 20px !important;
                padding-top: 15px !important;
                font-size: 10px !important;
            }
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #4682B4;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #4682B4;
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            color: #666;
            margin: 10px 0 0 0;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #4682B4;
            border-bottom: 2px solid #4682B4;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .kpi-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .kpi-card {
            background: linear-gradient(135deg, #4682B4, #5F9EA0);
            color: white !important;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 1px solid #4682B4;
        }
        .kpi-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }
        .kpi-card .value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .kpi-card .unit {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .chart-container {
            text-align: center;
            margin: 20px 0;
        }
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4682B4 !important;
            color: white !important;
            font-weight: bold;
            border: 1px solid #4682B4;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #e6f3ff;
        }
        .insights {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4682B4;
        }
        .insights ul {
            margin: 0;
            padding-left: 20px;
        }
        .insights li {
            margin-bottom: 8px;
        }
        .priority-high {
            color: #DC143C;
            font-weight: bold;
        }
        .priority-medium {
            color: #FF8C00;
            font-weight: bold;
        }
        .priority-low {
            color: #32CD32;
            font-weight: bold;
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .strategy-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #4682B4;
        }
        .strategy-card h4 {
            color: #4682B4;
            margin-top: 0;
            border-bottom: 1px solid #4682B4;
            padding-bottom: 10px;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1>{{ title }}</h1>
            <p>생성일: {{ generated_date }} | 버전: {{ version }}</p>
            <p>데이터 기간: {{ data_range.start }} ~ {{ data_range.end }}</p>
        </div>

        <!-- 1. 핵심 성과지표 -->
        <div class="section">
            <h2>1. 핵심 성과지표 (KPI)</h2>
            <div class="kpi-cards">
                <div class="kpi-card">
                    <h3>총 리뷰 수</h3>
                    <div class="value">{{ kpi.총_리뷰_수 }}</div>
                    <div class="unit">개</div>
                </div>
                <div class="kpi-card">
                    <h3>평균 평점</h3>
                    <div class="value">{{ "%.2f"|format(kpi.평균_평점) }}</div>
                    <div class="unit">/ 10점</div>
                </div>
                <div class="kpi-card">
                    <h3>긍정 비율</h3>
                    <div class="value">{{ "%.1f"|format(kpi.긍정_비율) }}%</div>
                    <div class="unit">({{ kpi.긍정_리뷰_수 }}개)</div>
                </div>
                <div class="kpi-card">
                    <h3>부정 비율</h3>
                    <div class="value">{{ "%.1f"|format(kpi.부정_비율) }}%</div>
                    <div class="unit">({{ kpi.부정_리뷰_수 }}개)</div>
                </div>
            </div>
        </div>

        <!-- 2. 성과지표 분석 -->
        <div class="section">
            <h2>2. 성과지표 분석</h2>
            <div class="chart-container">
                <img src="{{ plot_files.yearly_trend }}" alt="연도별 트렌드">
            </div>
            <div class="highlight">
                <strong>주요 트렌드:</strong>
                <ul>
                    <li>전체 평균 평점: {{ "%.2f"|format(kpi.평균_평점) }}점</li>
                    <li>최고 평점: {{ kpi.최고_평점 }}점, 최저 평점: {{ kpi.최저_평점 }}점</li>
                    <li>데이터 수집 기간: {{ kpi.데이터_기간.시작일 }} ~ {{ kpi.데이터_기간.종료일 }}</li>
                </ul>
            </div>
        </div>

        <!-- 3. 콘텐츠 특성별 성과 -->
        <div class="section">
            <h2>3. 콘텐츠 특성별 성과</h2>
            <div class="chart-container">
                <img src="{{ plot_files.segment_analysis }}" alt="세그먼트 분석">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>세그먼트</th>
                            <th>매칭 리뷰 수</th>
                            <th>평균 평점</th>
                            <th>긍정 비율</th>
                            <th>부정 비율</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for segment, data in segments.items() %}
                        <tr>
                            <td>{{ segment }}</td>
                            <td>{{ data.매칭_리뷰_수 }}</td>
                            <td>{{ "%.2f"|format(data.평균_평점) }}</td>
                            <td>{{ "%.1f"|format(data.긍정_비율) }}%</td>
                            <td>{{ "%.1f"|format(data.부정_비율) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 4. 감정분석 -->
        <div class="section">
            <h2>4. 감정분석</h2>
            <div class="chart-container">
                <img src="{{ plot_files.sentiment_distribution }}" alt="감정 분포">
            </div>
            <div class="insights">
                <strong>감정 분석 결과:</strong>
                <ul>
                    <li>긍정 리뷰: {{ kpi.긍정_리뷰_수 }}개 ({{ "%.1f"|format(kpi.긍정_비율) }}%)</li>
                    <li>중립 리뷰: {{ kpi.중립_리뷰_수 }}개 ({{ "%.1f"|format(kpi.중립_비율) }}%)</li>
                    <li>부정 리뷰: {{ kpi.부정_리뷰_수 }}개 ({{ "%.1f"|format(kpi.부정_비율) }}%)</li>
                </ul>
            </div>
        </div>

        <!-- 5. 주요 인사이트 -->
        <div class="section">
            <h2>5. 주요 인사이트</h2>
            <div class="insights">
                <ul>
                    <li>전체 {{ kpi.총_리뷰_수 }}개의 리뷰 중 {{ "%.1f"|format(kpi.긍정_비율) }}%가 긍정적인 평가를 보여 전반적으로 만족도가 높습니다.</li>
                    <li>평균 평점 {{ "%.2f"|format(kpi.평균_평점) }}점으로 업계 평균 대비 양호한 수준입니다.</li>
                    <li>부정 리뷰 비율 {{ "%.1f"|format(kpi.부정_비율) }}%로 개선 여지가 있는 영역이 존재합니다.</li>
                    <li>온천수 관련 리뷰가 가장 높은 만족도를 보이며, 시설/온수 관련 개선이 필요합니다.</li>
                    <li>가족 고객 세그먼트가 주요 고객층으로 확인되어 가족 친화적 서비스 강화가 중요합니다.</li>
                </ul>
            </div>
        </div>

        <!-- 6. 개선사항 우선순위 -->
        <div class="section">
            <h2>6. 개선사항 우선순위</h2>
            <div class="chart-container">
                <img src="{{ plot_files.priority_scores }}" alt="우선순위 점수">
            </div>
            <div class="chart-container">
                <img src="{{ plot_files.aspect_sentiment }}" alt="Aspect별 감정 분포">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>Aspect</th>
                            <th>부정 비율</th>
                            <th>언급 빈도</th>
                            <th>우선순위 점수</th>
                            <th>매칭 리뷰 수</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in priority.상위_3개 %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ item.Aspect }}</td>
                            <td class="priority-{% if item.부정_비율 > 30 %}high{% elif item.부정_비율 > 15 %}medium{% else %}low{% endif %}">
                                {{ "%.1f"|format(item.부정_비율) }}%
                            </td>
                            <td>{{ "%.1f"|format(item.언급_빈도) }}%</td>
                            <td class="priority-{% if item.우선순위_점수 > 50 %}high{% elif item.우선순위_점수 > 25 %}medium{% else %}low{% endif %}">
                                {{ "%.2f"|format(item.우선순위_점수) }}
                            </td>
                            <td>{{ item.매칭_리뷰_수 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 7. 전략적 제언 -->
        <div class="section">
            <h2>7. 전략적 제언</h2>
            <div class="strategy-grid">
                <div class="strategy-card">
                    <h4>단기 전략 (3-6개월)</h4>
                    <ul>
                        <li>시설/온수 관련 긴급 개선사항 해결</li>
                        <li>직원 서비스 교육 강화</li>
                        <li>부정 키워드 모니터링 시스템 구축</li>
                    </ul>
                </div>
                <div class="strategy-card">
                    <h4>중기 전략 (6-12개월)</h4>
                    <ul>
                        <li>시설 리모델링 및 현대화</li>
                        <li>고객 만족도 향상 프로그램 도입</li>
                        <li>온천수 품질 관리 시스템 고도화</li>
                    </ul>
                </div>
                <div class="strategy-card">
                    <h4>장기 전략 (1년 이상)</h4>
                    <ul>
                        <li>브랜드 이미지 개선 및 마케팅 강화</li>
                        <li>지속가능한 서비스 품질 관리 체계 구축</li>
                        <li>고객 세그먼트별 맞춤 서비스 개발</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 8. 결론 및 향후 방향 -->
        <div class="section">
            <h2>8. 결론 및 향후 방향</h2>
            <div class="highlight">
                <strong>핵심 결론:</strong>
                <ol>
                    <li>전반적인 고객 만족도는 양호하나, 시설/온수 관련 개선이 시급합니다.</li>
                    <li>온천수는 핵심 경쟁력으로 확인되어 지속적인 품질 관리가 필요합니다.</li>
                    <li>가족 고객 중심의 서비스 전략이 효과적임을 확인했습니다.</li>
                    <li>직원 서비스 품질 향상을 통한 고객 경험 개선이 중요합니다.</li>
                    <li>체계적인 개선사항 추적 및 관리 시스템 구축이 필요합니다.</li>
                </ol>
            </div>
        </div>

        <!-- 부정 키워드 분석 -->
        <div class="section">
            <h2>부정 키워드 분석</h2>
            <div class="chart-container">
                <img src="{{ plot_files.negative_keywords }}" alt="부정 키워드">
            </div>
        </div>

        <!-- 고급 분석 결과 -->
        {% if advanced_analysis %}
        
        <!-- 5. 평점 예측 모델 분석 -->
        <div class="section">
            <h2>5. 평점 예측 모델 분석</h2>
            {% if advanced_analysis.rating_prediction %}
            <div class="chart-container">
                <img src="{{ plot_files.model_performance }}" alt="모델 성능 비교">
            </div>
            {% if advanced_analysis.rating_prediction.SHAP_Analysis %}
            <div class="chart-container">
                <img src="{{ plot_files.shap_feature_importance }}" alt="SHAP 특성 중요도">
            </div>
            <div class="table-container">
                <h4>SHAP 상위 특성 영향도</h4>
                <table>
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>특성명</th>
                            <th>중요도</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for feature, importance in advanced_analysis.rating_prediction.SHAP_Analysis.top_features %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ feature }}</td>
                            <td>{{ "%.4f"|format(importance) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
            {% endif %}
        </div>

        <!-- 6. 토픽 모델링 분석 -->
        <div class="section">
            <h2>6. 토픽 모델링 분석</h2>
            {% if advanced_analysis.topic_modeling %}
            <div class="chart-container">
                <img src="{{ plot_files.topic_distribution }}" alt="토픽 분포">
            </div>
            <div class="table-container">
                <h4>토픽별 주요 키워드</h4>
                <table>
                    <thead>
                        <tr>
                            <th>토픽 ID</th>
                            <th>주요 키워드</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for topic in advanced_analysis.topic_modeling.topics %}
                        <tr>
                            <td>토픽 {{ topic.topic_id }}</td>
                            <td>{{ topic.top_words[:5] | join(', ') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>

        <!-- 7. 변화점 탐지 분석 -->
        <div class="section">
            <h2>7. 변화점 탐지 분석</h2>
            {% if advanced_analysis.change_point_detection %}
            <div class="chart-container">
                <img src="{{ plot_files.change_point_detection }}" alt="변화점 탐지">
            </div>
            {% if advanced_analysis.change_point_detection.change_points %}
            <div class="table-container">
                <h4>탐지된 변화점</h4>
                <table>
                    <thead>
                        <tr>
                            <th>연도</th>
                            <th>변화 전 평점</th>
                            <th>변화 후 평점</th>
                            <th>변화량</th>
                            <th>변화 유형</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cp in advanced_analysis.change_point_detection.change_points %}
                        <tr>
                            <td>{{ cp.year }}</td>
                            <td>{{ cp.rating_before }}</td>
                            <td>{{ cp.rating_after }}</td>
                            <td class="change-{% if cp.change > 0 %}positive{% else %}negative{% endif %}">
                                {{ "%.2f"|format(cp.change) }}
                            </td>
                            <td>{{ cp.change_type }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
            {% endif %}
        </div>

        {% endif %}

        <!-- 푸터 -->
        <div class="footer">
            <p><strong>재현 명령어:</strong> {{ reproduction_command }}</p>
            <p>이 리포트는 자동으로 생성되었습니다. 데이터 기반 의사결정을 위해 활용하시기 바랍니다.</p>
            <p>(주)파로스</p>
        </div>
    </div>
</body>
</html>
